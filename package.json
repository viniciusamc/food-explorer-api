version: "3.9"

services:
  app:
    build: .
    command: yarn dev
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: development
      DB_CLIENT: sqlite3
      DB_CONNECTION_FILENAME: /app/data/db.sqlite
    volumes:
      - .:/app
      - /app/data

  db:
    image: sqlite
    volumes:
      - ./data:/data
    environment:
      SQLITE_DATABASE: /data/food-explorer.db

  migrations:
    build: .
    command: yarn migrate
    environment:
      NODE_ENV: development
      DB_CLIENT: sqlite3
      DB_CONNECTION_FILENAME: /app/data/db.sqlite
    volumes:
      - .:/app
      - /app/data

  seeds:
    build: .
    command: yarn resdb
    environment:
      NODE_ENV: development
      DB_CLIENT: sqlite3
      DB_CONNECTION_FILENAME: /app/data/db.sqlite
    volumes:
      - .:/app
      - /app/data

  tests:
    build: .
    command: yarn test
    environment:
      NODE_ENV: test
      DB_CLIENT: sqlite3
      DB_CONNECTION_FILENAME: /app/data/test.db
    volumes:
      - .:/app
      - /app/data
